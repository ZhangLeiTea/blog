# shared_ptr

## 1. 引用计数的实现

> shared_ptr的大小是原始指针的2倍
>> shared_ptr内部保存了2个指针：raw pointer to the resource和 指向引用计数的指针  
> 说明了shared_ptr这个对象管理了2个资源，一个是原始资源，一个是引用计数资源
>
> shared_ptr对引用计数提供atomic访问
> > 即指向相同原始资源的shared_ptr对象，在不同的线程中可以安全的读写（前提是触发原始资源的析构）

## 2. 引用计数为什么要原子访问

> shared_ptr这个对象管理了2个资源，引用计数资源是shared_ptr创建的，所以需要它自己来保证线程安全
> 原始资源的线程安全，不是shared_ptr的责任，需要用户自己保证，这个原子的线程安全不是由shared_ptr负责的
> > 在使用原始资源时（例如调用原始资源的成员函数）需要用户自己保证线程安全。
> > 例如调用原始资源的成员函数，成员函数里加锁读写