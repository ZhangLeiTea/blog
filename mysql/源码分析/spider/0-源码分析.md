# 1. 入口

## 1 spider/spd_param.cc

- 重要的结构体

    ```  c++  
    maria_declare_plugin(spider)  
    {  
        MYSQL_STORAGE_ENGINE_PLUGIN,  
        &spider_storage_engine,  
        "SPIDER",  
        "Kentoku Shiba",  
        "Spider storage engine",                /* Plugin name with full version*/
        PLUGIN_LICENSE_GPL,  
        spider_db_init,                         /* Plugin Init */
        spider_db_done,  
        SPIDER_HEX_VERSION,                     /* Plugin Version: major.minor */
        spider_status_variables,                /* status variables */
        spider_system_variables,                /* system variables */
        SPIDER_DETAIL_VERSION,  
        MariaDB_PLUGIN_MATURITY_GAMMA  
    }  
    ```

- 注册spider的初始化函数等

## 2. spider/spd_table.cc

- spider_db_init()函数的实现
- 分析create table 等sql，当engine=spider时，将分析结果传给spd_con.cc


# 2. 几个重要的数据结构

1. handler 插件基类

    - The handler class is the interface for dynamically loadable storage engines
    - 
    - 源码解析
  
        ``` c++

        ```

2. handlerton 插件基类

    - 简介
      - handlerton is a singleton structure - one instance per storage engine
      - to provide access to storage engine functionality that works on the "global" level
      - unlike handler class that works on a per-table basis
      - usually handlerton instance is defined statically in ha_xxx.cc as static handlerton { ... } xxx_hton;
    - 分析
      - handlerton是由[spider_db_init]当做这个函数的参数传入的
      - 
    - 源码解析
  
        ``` c++

        ```

3. static handlerton *installed_htons[128];
    - 表示所有安装的插件

    ---

4. st_plugin_int
   1. A handle of a plugin
   2. 插件的句柄，它代表了一个插件的所有信息。类似win32的窗口句柄

        ``` c++
        struct st_plugin_int {
        LEX_CSTRING name{nullptr, 0};
        st_mysql_plugin *plugin{nullptr};
        st_plugin_dl *plugin_dl{nullptr};
        uint state{0};
        uint ref_count{0};             /* number of threads using the plugin */
        void *data{nullptr};           /* plugin type specific, e.g. handlerton */
        MEM_ROOT mem_root;             /* memory for dynamic plugin structures */
        sys_var *system_vars{nullptr}; /* server variables for this plugin */
        enum_plugin_load_option load_option{
            PLUGIN_OFF}; /* OFF, ON, FORCE, F+PERMANENT */
        };
        ```

    ---
5. 插件结构体

   ``` c++
    struct st_mysql_plugin
    {
        int type;             /* the plugin type (a MYSQL_XXX_PLUGIN value)   */
        void *info;           /* pointer to type-specific plugin descriptor   */
        const char *name;     /* plugin name                                  */
        const char *author;   /* plugin author (for I_S.PLUGINS)              */
        const char *descr;    /* general descriptive text (for I_S.PLUGINS)   */
        int license;          /* the plugin license (PLUGIN_LICENSE_XXX)      */
        int (*init)(void *);  /* the function to invoke when plugin is loaded */
        int (*deinit)(void *);/* the function to invoke when plugin is unloaded */
        unsigned int version; /* plugin version (for I_S.PLUGINS)             */
        struct st_mysql_show_var *status_vars;
        struct st_mysql_sys_var **system_vars;
        void * __reserved1;   /* reserved for dependency checking             */
        unsigned long flags;  /* flags for plugin */
    };
    ```
